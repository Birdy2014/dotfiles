#!/usr/bin/env bash

if ! command -v slock > /dev/null; then
    notify-send --urgency critical 'Screen locker "slock" not found'
    exit 1
fi

# Get original dpms times
times="$(xset q | grep Standby)"
standby_time="$(echo -n $times | sed 's/.*Standby: \([0-9]\+\) *Suspend: \([0-9]\+\) *Off: \([0-9]\+\)/\1/')"
suspend_time="$(echo -n $times | sed 's/.*Standby: \([0-9]\+\) *Suspend: \([0-9]\+\) *Off: \([0-9]\+\)/\2/')"
off_time="$(echo -n $times | sed 's/.*Standby: \([0-9]\+\) *Suspend: \([0-9]\+\) *Off: \([0-9]\+\)/\3/')"

# Set new times
xset dpms 5 5 5

# Start slock
/usr/bin/slock &
wait

# Reset
xset dpms $standby_time $suspend_time $off_time
