#!/usr/bin/sh

get_time() {
    echo "$(date "+%a %d %b %H:%M")"
}

get_volume() {
    if [ $(pamixer --get-mute) = true ]; then
        echo "üîà"
    else
        echo "üîä $(pamixer --get-volume)"
    fi
}

get_battery() {
    BATTERY_STATUS=$(cat /sys/class/power_supply/BAT?/status)
    BATTERY_CHARGE=$(cat /sys/class/power_supply/BAT?/capacity)
    if [ $BATTERY_STATUS = Discharging ]; then
        if [ $BATTERY_CHARGE -lt 10 ]; then
            echo "ÔâÑ  $BATTERY_CHARGE"
        elif [ $BATTERY_CHARGE -lt 25 ]; then
            echo "ÔâÉ  $BATTERY_CHARGE"
        elif [ $BATTERY_CHARGE -lt 50 ]; then
            echo "ÔâÇ  $BATTERY_CHARGE"
        elif [ $BATTERY_CHARGE -lt 75 ]; then
            echo "ÔâÅ  $BATTERY_CHARGE"
        else
            echo "ÔâÄ  $BATTERY_CHARGE"
        fi
    elif [ $BATTERY_STATUS = Charging ]; then
        echo "Ôá¶ $BATTERY_CHARGE"
    else
        echo "ERR"
    fi
}

get_wifi() {
    WIFI="$(nmcli -g NAME connection show --active || echo '')"
    [ "$WIFI" = "" ] && WIFI="not connected"
    echo $WIFI
}

update_statusbar() {
    if [ "$device" = "laptop" ]; then
        xsetroot -name "$(get_wifi) | $(get_battery) | $(get_volume) | $(get_time)"
    else
        xsetroot -name "$(get_volume) | $(get_time)"
    fi
}

timer() {
    while true; do
        update_statusbar
        sleep 1m
    done
}

case $1 in
    refresh) update_statusbar;;
    timer) [ $(ps -e | grep $(basename $0) | wc -l) -ge 3 ] || timer &;;
    stop) killall $(basename $0)
esac
